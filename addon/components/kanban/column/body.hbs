<div
    class="kanban-column-body"
    {{on "scroll" this.onScroll}}
    {{on "keydown" this.onKeyDown}}
    {{did-insert this.setupVirtualScrolling}}
    role="group"
    aria-label="Cards in {{@column.title}}"
    tabindex="0"
>
    {{#if @isEmpty}}
        {{! Empty state }}
        <div class="column-body-empty" role="status">
            <FaIcon @icon="inbox" @prefix="fas" class="empty-icon" />
            <p class="empty-text">
                {{#if @column.wipLimit}}
                    No cards yet. Add up to {{@column.wipLimit}} cards.
                {{else}}
                    No cards yet. Add your first card to get started.
                {{/if}}
            </p>
        </div>
    {{else}}
        {{! Cards container }}
        <div class="cards-container" style={{if this.isVirtualScrolling (concat "height: " this.totalHeight "px; position: relative;")}}>
            {{#if this.isVirtualScrolling}}
                {{! Virtual scrolling spacer }}
                <div style="height: {{this.offsetY}}px;"></div>
            {{/if}}

            {{! Render visible cards }}
            {{#each this.visibleCards as |card index|}}
                {{! Card drop indicator }}
                {{#if (and @dragOverCard (equal @dragOverCard card) (equal @dragOverPosition "before"))}}
                    <div class="card-drop-line before"></div>
                {{/if}}

                {{! Card component }}
                <Kanban::Card
                    @card={{card}}
                    @isSelected={{has this.selectedCards card.id}}
                    @isDragging={{equal @draggedCard card}}
                    @onDragStart={{fn this.onCardDragStart card}}
                    @onDragEnd={{fn this.onCardDragEnd card}}
                    @onSelect={{fn this.onCardSelect card}}
                    @onUpdate={{fn this.onCardUpdate card}}
                    @onDelete={{fn this.onCardDelete card}}
                    @columnId={{@columnId}}
                    @boardId={{@boardId}}
                    @readonly={{@readonly}}
                    @disabled={{@disabled}}
                    @template={{@cardTemplate}}
                    data-card-id={{card.id}}
                    style={{if this.isVirtualScrolling (concat "position: absolute; top: " (mul index this.itemHeight) "px; width: calc(100% - 16px);")}}
                />

                {{! Card drop indicator }}
                {{#if (and @dragOverCard (equal @dragOverCard card) (equal @dragOverPosition "after"))}}
                    <div class="card-drop-line after"></div>
                {{/if}}
            {{/each}}

            {{! Drop zone at end of column }}
            {{#if (and @isDragOver (not @dragOverCard))}}
                <div class="card-drop-zone">
                    <FaIcon @icon="plus" @prefix="fas" class="text-blue-500" />
                    <span class="text-blue-600 dark:text-blue-400 text-sm">Drop card here</span>
                </div>
            {{/if}}
        </div>

        {{! Bulk actions toolbar }}
        {{#if (gt this.selectedCards.size 0)}}
            <div class="bulk-actions-toolbar">
                <div class="bulk-actions-content">
                    <span class="selected-count">
                        {{this.selectedCards.size}} selected
                    </span>
                    <div class="bulk-actions-buttons">
                        <Button
                            @type="secondary"
                            @size="xs"
                            @icon="copy"
                            @text="Duplicate"
                            @onClick={{fn this.onBulkOperation "duplicate"}}
                            @helpText="Duplicate selected cards"
                        />
                        <Button
                            @type="secondary"
                            @size="xs"
                            @icon="archive"
                            @text="Archive"
                            @onClick={{fn this.onBulkOperation "archive"}}
                            @helpText="Archive selected cards"
                        />
                        <Button
                            @type="danger"
                            @size="xs"
                            @icon="trash"
                            @text="Delete"
                            @onClick={{fn this.onBulkOperation "delete"}}
                            @helpText="Delete selected cards"
                        />
                        <Button
                            @type="ghost"
                            @size="xs"
                            @icon="times"
                            @onClick={{this.clearSelection}}
                            @helpText="Clear selection"
                        />
                    </div>
                </div>
            </div>
        {{/if}}
    {{/if}}

    {{! Keyboard shortcuts help }}
    <div class="sr-only">
        <h4>Keyboard shortcuts for cards:</h4>
        <ul>
            <li>Arrow Up/Down: Navigate between cards</li>
            <li>Ctrl/Cmd + A: Select all cards</li>
            <li>Ctrl/Cmd + D: Duplicate selected cards</li>
            <li>Delete: Delete selected cards</li>
            <li>Escape: Clear selection</li>
            <li>Click + Ctrl/Cmd: Multi-select</li>
            <li>Click + Shift: Range select</li>
        </ul>
    </div>
</div>
