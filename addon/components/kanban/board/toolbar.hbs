<div
    class="kanban-toolbar"
    {{on "keydown" this.onKeyDown}}
    {{on "click" this.onClickOutside}}
>
    <div class="kanban-toolbar-main">
        {{! Search section }}
        <div class="kanban-toolbar-search">
            <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <FaIcon @icon="search" @prefix="fas" class="text-gray-400" />
                </div>
                <input
                    id="{{@boardId}}-search"
                    type="text"
                    class="form-input pl-10 pr-10"
                    placeholder="Search cards..."
                    value={{@searchQuery}}
                    {{on "input" this.onSearchInput}}
                    aria-label="Search cards"
                    aria-describedby="{{@boardId}}-search-help"
                />
                {{#if @searchQuery}}
                    <button
                        type="button"
                        class="absolute inset-y-0 right-0 pr-3 flex items-center"
                        {{on "click" this.clearSearch}}
                        aria-label="Clear search"
                    >
                        <FaIcon @icon="times" @prefix="fas" class="text-gray-400 hover:text-gray-600" />
                    </button>
                {{/if}}
            </div>
            <div id="{{@boardId}}-search-help" class="sr-only">
                Search by card title, description, assignee, or tags
            </div>
        </div>

        {{! Action buttons }}
        <div class="kanban-toolbar-actions">
            {{! Filter button }}
            <div class="relative">
                <Button
                    @type={{if this.hasActiveFilters "primary" "secondary"}}
                    @size="sm"
                    @icon="filter"
                    @text={{if this.hasActiveFilters (concat "Filters (" this.activeFilterCount ")") "Filters"}}
                    @onClick={{this.toggleFilters}}
                    @helpText="Filter cards"
                    class="toolbar-action-button"
                    aria-expanded={{this.showFilters}}
                    aria-haspopup="true"
                />

                {{! Filter dropdown }}
                {{#if this.showFilters}}
                    <div class="kanban-toolbar-dropdown kanban-filter-panel">
                        <div class="p-4 space-y-4">
                            <div class="flex items-center justify-between">
                                <h3 class="text-sm font-medium text-gray-900 dark:text-gray-100">Filters</h3>
                                {{#if this.hasActiveFilters}}
                                    <Button
                                        @type="link"
                                        @size="xs"
                                        @text="Clear All"
                                        @onClick={{this.clearAllFilters}}
                                    />
                                {{/if}}
                            </div>

                            {{! Priority filter }}
                            <div class="filter-group">
                                <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
                                    Priority
                                </label>
                                <Select
                                    @value={{@filters.priority}}
                                    @options={{this.priorityOptions}}
                                    @onChange={{this.onPriorityFilterChange}}
                                    @placeholder="All priorities"
                                    @size="sm"
                                />
                            </div>

                            {{! Assignee filter }}
                            {{#if @assigneeOptions}}
                                <div class="filter-group">
                                    <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
                                        Assignee
                                    </label>
                                    <ModelSelect
                                        @modelName="user"
                                        @selectedModel={{@filters.assignee}}
                                        @placeholder="All assignees"
                                        @onChange={{this.onAssigneeFilterChange}}
                                        @size="sm"
                                    />
                                </div>
                            {{/if}}

                            {{! Tags filter }}
                            {{#if @tagOptions}}
                                <div class="filter-group">
                                    <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
                                        Tags
                                    </label>
                                    <ModelSelectMultiple
                                        @modelName="tag"
                                        @selectedModels={{@filters.tags}}
                                        @placeholder="All tags"
                                        @onChange={{this.onTagsFilterChange}}
                                        @size="sm"
                                    />
                                </div>
                            {{/if}}

                            {{! Due date filter }}
                            <div class="filter-group">
                                <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
                                    Due Date
                                </label>
                                <DatePicker
                                    @value={{@filters.dueDate}}
                                    @onChange={{this.onDueDateFilterChange}}
                                    @placeholder="Filter by due date"
                                    @size="sm"
                                />
                            </div>
                        </div>
                    </div>
                {{/if}}
            </div>

            {{! Sort button }}
            <div class="relative">
                <Button
                    @type="secondary"
                    @size="sm"
                    @icon={{if (equal @sortDirection "desc") "sort-amount-down" "sort-amount-up"}}
                    @text="Sort"
                    @onClick={{this.toggleSortOptions}}
                    @helpText="Sort cards"
                    class="toolbar-action-button"
                    aria-expanded={{this.showSortOptions}}
                    aria-haspopup="true"
                />

                {{! Sort dropdown }}
                {{#if this.showSortOptions}}
                    <div class="kanban-toolbar-dropdown kanban-sort-panel">
                        <div class="p-2">
                            <h3 class="text-sm font-medium text-gray-900 dark:text-gray-100 px-3 py-2">Sort by</h3>
                            {{#each this.sortOptions as |option|}}
                                <button
                                    type="button"
                                    class="sort-option {{if (equal @sortBy option.value) 'active'}}"
                                    {{on "click" (fn this.onSortChange option.value)}}
                                >
                                    <span>{{option.label}}</span>
                                    {{#if (equal @sortBy option.value)}}
                                        <FaIcon 
                                            @icon={{if (equal @sortDirection "desc") "chevron-down" "chevron-up"}} 
                                            @prefix="fas" 
                                            class="text-blue-500"
                                        />
                                    {{/if}}
                                </button>
                            {{/each}}
                        </div>
                    </div>
                {{/if}}
            </div>

            {{! Create column button }}
            {{#unless @readonly}}
                <Button
                    @type="primary"
                    @size="sm"
                    @icon="plus"
                    @text="Add Column"
                    @onClick={{this.onCreateColumn}}
                    @helpText="Create a new column"
                    @disabled={{@disabled}}
                />
            {{/unless}}

            {{! View options }}
            <div class="kanban-toolbar-view-options">
                {{! Compact view toggle }}
                <Button
                    @type="secondary"
                    @size="sm"
                    @icon="compress-alt"
                    @onClick={{@onToggleCompactView}}
                    @helpText="Toggle compact view"
                    class="toolbar-action-button"
                />

                {{! Fullscreen toggle }}
                <Button
                    @type="secondary"
                    @size="sm"
                    @icon="expand"
                    @onClick={{@onToggleFullscreen}}
                    @helpText="Toggle fullscreen"
                    class="toolbar-action-button"
                />
            </div>
        </div>
    </div>

    {{! Mobile responsive toolbar }}
    <div class="kanban-toolbar-mobile sm:hidden">
        <div class="flex items-center justify-between">
            <Button
                @type="secondary"
                @size="sm"
                @icon="search"
                @onClick={{this.toggleSearch}}
                @helpText="Search"
            />
            
            <div class="flex space-x-2">
                <Button
                    @type={{if this.hasActiveFilters "primary" "secondary"}}
                    @size="sm"
                    @icon="filter"
                    @onClick={{this.toggleFilters}}
                    @helpText="Filters"
                />
                
                <Button
                    @type="secondary"
                    @size="sm"
                    @icon="sort"
                    @onClick={{this.toggleSortOptions}}
                    @helpText="Sort"
                />
                
                {{#unless @readonly}}
                    <Button
                        @type="primary"
                        @size="sm"
                        @icon="plus"
                        @onClick={{this.onCreateColumn}}
                        @helpText="Add Column"
                        @disabled={{@disabled}}
                    />
                {{/unless}}
            </div>
        </div>
    </div>
</div>
