<div class="computed-column-editor">
    <div class="modal-header">
        <h4 class="modal-title">
            {{#if @computedColumn}}
                Edit Computed Column
            {{else}}
                Add Computed Column
            {{/if}}
        </h4>
    </div>

    <div class="modal-body">
        <div class="space-y-4">
            {{! Column Name }}
            <div class="form-group">
                <label class="form-label required">Column Name</label>
                <Input
                    @type="text"
                    @value={{this.name}}
                    {{on "input" this.updateName}}
                    class="form-input w-full"
                    placeholder="e.g., hire_days"
                    disabled={{this.isValidating}}
                />
                <p class="form-help">
                    The internal name for this column (lowercase, underscores only)
                </p>
            </div>

            {{! Display Label }}
            <div class="form-group">
                <label class="form-label required">Display Label</label>
                <Input
                    @type="text"
                    @value={{this.label}}
                    {{on "input" this.updateLabel}}
                    class="form-input w-full"
                    placeholder="e.g., Hire Days"
                    disabled={{this.isValidating}}
                />
                <p class="form-help">
                    The human-readable label shown in reports
                </p>
            </div>

            {{! Data Type }}
            <div class="form-group">
                <label class="form-label">Data Type</label>
                <PowerSelect
                    @options={{this.typeOptions}}
                    @selected={{this.type}}
                    @onChange={{this.updateType}}
                    @searchEnabled={{false}}
                    @placeholder="Select data type"
                    as |option|
                >
                    {{option.label}}
                </PowerSelect>
                <p class="form-help">
                    The expected data type of the computed value
                </p>
            </div>

            {{! Expression }}
            <div class="form-group">
                <label class="form-label required">Expression</label>
                <Textarea
                    @value={{this.expression}}
                    {{on "input" this.updateExpression}}
                    class="form-input w-full font-mono text-sm"
                    rows="4"
                    placeholder="e.g., DATEDIFF(end_date, start_date) + 1"
                    disabled={{this.isValidating}}
                />
                
                {{#if this.isValidating}}
                    <div class="flex items-center mt-2 text-blue-600">
                        <FaIcon @icon="spinner" @spin={{true}} class="mr-2" />
                        <span class="text-sm">Validating expression...</span>
                    </div>
                {{else if this.isValid}}
                    <div class="flex items-center mt-2 text-green-600">
                        <FaIcon @icon="check-circle" class="mr-2" />
                        <span class="text-sm">Expression is valid</span>
                    </div>
                {{else if this.validationErrors.length}}
                    <div class="mt-2">
                        {{#each this.validationErrors as |error|}}
                            <div class="flex items-start text-red-600 text-sm mb-1">
                                <FaIcon @icon="exclamation-circle" class="mr-2 mt-0.5" />
                                <span>{{error}}</span>
                            </div>
                        {{/each}}
                    </div>
                {{/if}}

                <p class="form-help mt-2">
                    SQL expression using allowed functions and column references
                </p>
            </div>

            {{! Description }}
            <div class="form-group">
                <label class="form-label">Description</label>
                <Textarea
                    @value={{this.description}}
                    {{on "input" this.updateDescription}}
                    class="form-input w-full"
                    rows="2"
                    placeholder="Optional description of what this column calculates"
                    disabled={{this.isValidating}}
                />
            </div>

            {{! Allowed Functions Reference }}
            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
                <h5 class="font-semibold mb-2 text-sm">Allowed Functions</h5>
                <div class="flex flex-wrap gap-2">
                    {{#each this.allowedFunctions as |func|}}
                        <span class="inline-flex items-center px-2 py-1 rounded text-xs font-mono bg-gray-200 dark:bg-gray-700">
                            {{func}}
                        </span>
                    {{/each}}
                </div>
            </div>

            {{! Example Expressions }}
            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4">
                <h5 class="font-semibold mb-3 text-sm">Example Expressions</h5>
                <div class="space-y-3">
                    {{#each this.exampleExpressions as |example|}}
                        <div class="border-l-2 border-blue-400 pl-3">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <p class="font-medium text-sm">{{example.name}}</p>
                                    <code class="text-xs bg-white dark:bg-gray-800 px-2 py-1 rounded mt-1 block">
                                        {{example.expression}}
                                    </code>
                                    <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">
                                        {{example.description}}
                                    </p>
                                </div>
                                <Button
                                    @text="Use"
                                    @type="default"
                                    @size="xs"
                                    @onClick={{fn this.useExample example}}
                                    class="ml-2"
                                />
                            </div>
                        </div>
                    {{/each}}
                </div>
            </div>
        </div>
    </div>

    <div class="modal-footer">
        <Button
            @text="Cancel"
            @type="default"
            @onClick={{this.cancel}}
            @disabled={{this.isValidating}}
        />
        <Button
            @text={{if @computedColumn "Update" "Add"}}
            @type="primary"
            @onClick={{this.save}}
            @disabled={{not this.canSave}}
            @isLoading={{this.isValidating}}
        />
    </div>
</div>
